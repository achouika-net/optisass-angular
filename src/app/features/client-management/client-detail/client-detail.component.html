<div class="dossier-client-container">
    <!-- Header -->
    <div class="client-header-pro">
        <div class="header-content">
            <mat-icon class="header-icon">folder_shared</mat-icon>
            <div class="header-text">
                <h1>{{ isClientPro() ? client?.raisonSociale : titleClient() }}</h1>
                <span class="subtitle">Dossier Client N° {{ client?.id }}</span>
            </div>
        </div>
        <button mat-icon-button (click)="goBack()" class="close-btn">
            <mat-icon>close</mat-icon>
        </button>
    </div>

    <!-- Tabs Container -->
    <mat-tab-group class="client-tabs" animationDuration="0ms">

        <!-- ONGLET 1 : INFORMATIONS & HISTORIQUE -->
        <mat-tab label="Informations Générales">
            <div class="tab-content">
                <div class="dashboard-grid">
                    <!-- Colonne Gauche : Information Client -->
                    <div class="left-col">
                        <section class="info-card">
                            <div class="card-header">
                                <mat-icon>person</mat-icon>
                                <h2>Informations Personnelles</h2>
                            </div>
                            <div class="info-content">
                                <ng-container *ngIf="clientParticulier"> <!-- Template Particulier existant -->
                                    <div class="info-row">
                                        <span class="label">Nom Complet</span>
                                        <span class="value">{{ clientParticulier.titre }} {{ clientParticulier.nom }} {{
                                            clientParticulier.prenom }}</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="label">CIN</span>
                                        <span class="value">{{ clientParticulier.cin }}</span>
                                    </div>
                                    <div class="info-row">
                                        <span class="label">Téléphone</span>
                                        <section class="history-card">
                                            <div class="card-header">
                                                <mat-icon>history</mat-icon>
                                                <h2>Historique des Dossiers</h2>
                                            </div>
                                            <div class="history-list" *ngIf="fiches.length > 0">
                                                <div class="history-item" *ngFor="let fiche of fiches">
                                                    <div class="item-icon">
                                                        <mat-icon>{{ getTypeIcon(fiche.type) }}</mat-icon>
                                                    </div>
                                                    <div class="item-details">
                                                        <span class="item-type">{{ fiche.type }}</span>
                                                        <span class="item-date">{{ fiche.dateCreation |
                                                            date:'dd/MM/yyyy' }}</span>
                                                    </div>
                                                    <button mat-icon-button color="primary" (click)="viewFiche(fiche)">
                                                        <mat-icon>visibility</mat-icon>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="empty-history" *ngIf="fiches.length === 0">
                                                <mat-icon>inbox</mat-icon>
                                                <p>Aucun historique disponible</p>
                                            </div>
                                        </section>
                                    </div>
                            </div>
                    </div>
        </mat-tab>

        <!-- Onglet Dossier Médical (uniquement pour Particulier) -->
        <mat-tab label="Dossier Médical">
            <div class="tab-content medical-notes">
                <!-- Message si aucun dossier -->
                <div class="empty-state" *ngIf="!clientParticulier?.dossierMedical">
                    <mat-icon>folder_off</mat-icon>
                    <p>Aucune information médicale disponible.</p>
                </div>

                <div *ngIf="clientParticulier?.dossierMedical as dossier">
                    <div class="medical-section">
                        <h3><mat-icon>visibility</mat-icon> Antécédents Visuels</h3>
                        <div class="info-grid">
                            <div class="info-item" *ngIf="dossier.correctionActuelle">
                                <label>Correction actuelle</label>
                                <span>{{ dossier.correctionActuelle }}</span>
                            </div>
                            <div class="info-item" *ngIf="dossier.dureePort">
                                <label>Durée de port</label>
                                <span>{{ dossier.dureePort }}</span>
                            </div>
                        </div>
                        <div class="checkbox-grid">
                            <mat-chip-set>
                                <mat-chip *ngIf="dossier.traumatisme" color="warn">Traumatisme</mat-chip>
                                <mat-chip *ngIf="dossier.operation" color="warn">Opération</mat-chip>
                                <mat-chip *ngIf="dossier.inflammation" color="warn">Inflammation</mat-chip>
                                <mat-chip *ngIf="dossier.sensibiliteLumiere" color="warn">Sensibilité
                                    lumière</mat-chip>
                                <mat-chip *ngIf="dossier.secheresse" color="warn">Sécheresse</mat-chip>
                            </mat-chip-set>
                        </div>
                    </div>

                    <div class="medical-section"
                        *ngIf="dossier.maladiesChroniques?.actif || dossier.traitementMedicamenteux?.actif || dossier.allergies?.actif">
                        <h3><mat-icon>local_hospital</mat-icon> Antécédents Médicaux</h3>
                        <div class="info-item" *ngIf="dossier.maladiesChroniques?.actif">
                            <label>Maladies chroniques</label>
                            <p>{{ dossier.maladiesChroniques.details }}</p>
                        </div>
                        <div class="info-item" *ngIf="dossier.traitementMedicamenteux?.actif">
                            <label>Traitements médicamenteux</label>
                            <p>{{ dossier.traitementMedicamenteux.details }}</p>
                        </div>
                        <div class="info-item" *ngIf="dossier.allergies?.actif">
                            <label>Allergies</label>
                            <p>{{ dossier.allergies.details }}</p>
                        </div>
                    </div>

                    <div class="medical-section" *ngIf="dossier.remarques">
                        <h3><mat-icon>notes</mat-icon> Remarques</h3>
                        <p class="remarques">{{ dossier.remarques }}</p>
                    </div>
                </div>
            </div>
</div>
</mat-tab>
</mat-tab-group>

<!-- Footer Actions -->
<div class="footer-actions">
    <div class="action-buttons">
        <button mat-raised-button color="primary" (click)="createFicheMonture()">
            <mat-icon>visibility</mat-icon>
            Nouveau Dossier Monture
        </button>
        <button mat-raised-button color="primary" (click)="createFicheLentilles()">
            <mat-icon>remove_red_eye</mat-icon>
            Nouveau Dossier Lentilles
        </button>
        <button mat-raised-button color="accent" (click)="createFicheProduit()">
            <mat-icon>shopping_cart</mat-icon>
            Nouveau Dossier Produit
        </button>
    </div>
    <button mat-stroked-button (click)="goBack()">Fermer</button>
</div>
</div>